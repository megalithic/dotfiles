#!/usr/bin/env bash

#
# What in tarnation?
#
# CLI tool to control Hubitat (my devices and stuff)
# Requires the Maker API app to be installed in your Hubitat setup
#


base_command="$(basename "$0")"

# device_id="$1"
# hubitat_cloud_url="http://cloud.hubitat.com/api/$HUBITAT_ID/apps/$HUBITAT_APP_ID_MAKER/ifttt/{EVENT-NAME}?access_token=$HUBITAT_TOKEN"
command=""

help() {
  printf -- "Usage: "$base_command" <subcommand> <device_id>\n"
  printf -- "Subcommands:\n"
  printf -- "    on       Turn ON specific device\n"
  printf -- "    off      Turn OFF specific device\n"
  # printf -- "    toggle   Toggle specific device ON and OFF\n"
  # printf -- "    status   Get the current status of specific device\n"
}

hubitat_local_url() {
  echo "http://$HUBITAT_LAN/apps/api/$HUBITAT_APP_ID_MAKER/devices/$device_id/$command?access_token=$HUBITAT_TOKEN"
}

execute_command() {
  curl -s "$(hubitat_local_url)"
}

on() {
  command="on"
  execute_command
}

off() {
  command="off"
  execute_command
}

# toggle() {
#   if $(current_status); then
#     off
#   else
#     on
#   fi

#   status
# }

current_status() {
  command=""
  execute_command
}

# status() {
#   if $(current_status); then
#     echo "Status: on"
#   else
#     echo "Status: off"
#   fi
# }

subcommand=$1
device_id=$2

case $subcommand in
  '')
    # toggle ;;
    help ;;
  '-h' | '--help')
    help ;;
  *)
    shift
    ${subcommand} $@
    ;;
esac
