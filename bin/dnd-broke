#!/bin/sh

#
# What in tarnation?
#
# CLI tool to control macOS/notification center do-not-disturb mode
#
# Credit where credit is due!
#   * paulrudy; https://github.com/paulrudy/alfred-toggle-do-not-disturb
#


command="$(basename "$0")"

help() {
  printf -- "Usage: "$command" <subcommand> [options]\n"
  printf -- "Subcommands:\n"
  printf -- "    on       Turn ON do not disturb mode\n"
  printf -- "    off      Turn OFF do not disturb mode\n"
  printf -- "    status   Get the current status of do not disturb mode\n"
}

on() {
  sleep 1
  defaults -currentHost write "${HOME}/Library/Preferences/ByHost/com.apple.notificationcenterui" doNotDisturb -boolean true
  defaults -currentHost write "${HOME}/Library/Preferences/ByHost/com.apple.notificationcenterui" doNotDisturbDate -date "`date -u +\"%Y-%m-%d %H:%M:%S +000\"`"
  # launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist 2> /dev/null
  killall NotificationCenter
}

off() {
  defaults -currentHost write "${HOME}/Library/Preferences/ByHost/com.apple.notificationcenterui" doNotDisturb -boolean false
  # launchctl load -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist 2> /dev/null
  # open /System/Library/CoreServices/NotificationCenter.app/
  killall NotificationCenter
}

status() {
  current_status=$(defaults -currentHost read "${HOME}/Library/Preferences/ByHost/com.apple.notificationcenterui" doNotDisturb -boolean)
  if [[ $current_status == 1 ]]; then
    echo "on"
  else
    echo "off"
  fi
}

subcommand=$1
case $subcommand in
  '' | '-h' | '--help')
    help ;;
  *)
    shift
    ${subcommand} $@
    ;;
esac
