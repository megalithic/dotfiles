#!/usr/bin/env bash

# @REF:
# https://github.com/kovidgoyal/kitty/issues/3328#issuecomment-785435092

set -euo pipefail

sessions_path="$HOME/.dotfiles/config/kitty/sessions"

selected_session=$(fd conf "$sessions_path" |
  sed "s~$sessions_path/~~" |
  fzf-tmux --cycle --layout=reverse --preview-window="hidden" --prompt 'session> ' |
  sed "s~^~$sessions_path/~")

if [[ -n $selected_session ]]; then
  tab_name=$(echo "$selected_session" | xargs basename | sed 's/\.[^.]*$//')
  # echo "$tab_name found"
  # kitty @ focus-tab --match title:"$tab_name" 2>/dev/null || kitty @ new-window --new-tab --tab-title "$tab_name" --cwd "$selected_session"
  echo "Switching to $tab_name session.."
  kitty --session "$selected_session"
  # kitty @ focus-tab --match title:"$tab_name" 2>/dev/null || kitty @ new-window --new-tab --tab-title "$tab_name" --cwd "$selected_session"
fi

# function kt -d "kitty tab from ~/Dev/*"
#   set -l path $HOME/Dev
#   set -l selected_dir (
#     find $path/* -maxdepth 1 -mindepth 1 -type d |
#       sed "s~$path/~~" |
#       fzf-tmux -p --cycle --layout=reverse --prompt 't> ' |
#       sed "s~^~$path/~"
#   )

#   if test -n "$selected_dir"
#     set -l tab_name (echo $selected_dir | sed "s~$path/~~")
#     kitty @ focus-tab --match title:$tab_name 2>/dev/null || kitty @ new-window --new-tab --tab-title $tab_name --cwd $selected_dir
#   end
# end
