#!/usr/bin/env zsh

set -euo pipefail

#
# What in tarnation?
#
# CLI tool to control macOS/notification center do-not-disturb (DND) mode
# REQUIRES: `brew install "vitorgalvao/tiny-scripts/calm-notifications"`
# REF: https://github.com/vitorgalvao/tiny-scripts/blob/master/calm-notifications
# OLD VERSION: https://github.com/megalithic/dotfiles_bak/blob/b1f03a255678d91b39e87419b44ccf28a4ceb17f/bin/dnd
#

dnd_cmd="$HOME/.dotfiles/bin/dnd.rb"
command=""
subcommand=""

# if ! which dnd.rb &>/dev/null; then
#   printf "$(tput setaf 1)âœ– %s$(tput sgr0)\n" 'unable to run dnd; it requires `brew install "vitorgalvao/tiny-scripts/calm-notifications"`'
#   return 1
# fi

command="$(basename "$0")"

help() {
  printf -- "Usage: "$command" <subcommand> [options]\n"
  printf -- "Subcommands:\n"
  printf -- "    on       Turn ON do-not-disturb (DND) mode\n"
  printf -- "    off      Turn OFF do-not-disturb (DND) mode\n"
  printf -- "    toggle   Toggle do-not-disturb (DND) mode ON and OFF\n"
  printf -- "    status   Get the current status of do-not-disturb (DND) mode\n"
}

on() {
  $dnd_cmd on
}

off() {
  $dnd_cmd off
}

toggle() {
  $dnd_cmd toggle

  status
}

status() {
  echo "$($dnd_cmd status)"
}

subcommand="${1:-}"
case $subcommand in
  '')
    toggle
    ;;
  '-h' | '--help')
    help
    ;;
  *)
    shift
    ${subcommand} $@
    ;;
esac
