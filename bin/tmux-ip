#!/usr/bin/env zsh

## FIXME:
# - need to optimize performance here; WAY too many redundant checks

wan=$(dig +short myip.opendns.com @resolver1.opendns.com)
# external=$(wget -q -O - "http://myexternalip.com/raw")

tun=""
[[ -n $(ifconfig utun0 | ag 'inet ' | awk '{print "["$2"] "}') ]] && tun=$(ifconfig utun0 | ag 'inet ' | awk '{print "["$2"] "}')
[[ -n $(ifconfig utun3 | ag 'inet ' | awk '{print "["$2"] "}') ]] && tun=$(ifconfig utun3 | ag 'inet ' | awk '{print "["$2"] "}')

lan=""
[[ -n $(ifconfig en0 | ag 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}') ]] && lan=$(ifconfig en0 | ag 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}')
[[ -n $(ifconfig en1 | ag 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}') ]] && lan=$(ifconfig en1 | ag 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}')
[[ -n $(ifconfig en7 | ag 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}') ]] && lan=$(ifconfig en7 | ag 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}')
[[ -n $(ifconfig en8 | ag 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}') ]] && lan=$(ifconfig en8 | ag 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}')

echo "#[fg=brightblue]礪$wan #[fg=colour136]$tun#[fg=white] #[fg=yellow]$lan"
