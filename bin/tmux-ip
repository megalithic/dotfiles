#!/usr/bin/env zsh

# display wan and lan ip addresses only when we're not pairing
# $(tmux display-message -p '#S') != 'pairing' &&
  while true
  do
    if [[ $(dnd status) == "off" ]]; then
      wan=$(dig +short myip.opendns.com @resolver1.opendns.com)
      # external=$(wget -q -O - "http://myexternalip.com/raw")

      tun=""
      [[ -n $(ifconfig utun0 | rg 'inet ') ]] && tun=$(ifconfig utun0 | rg 'inet ' | awk '{print "["$2"] "}')
      [[ -n $(ifconfig utun1 | rg 'inet ') ]] && tun=$(ifconfig utun1 | rg 'inet ' | awk '{print "["$2"] "}')
      [[ -n $(ifconfig utun2 | rg 'inet ') ]] && tun=$(ifconfig utun2 | rg 'inet ' | awk '{print "["$2"] "}')
      [[ -n $(ifconfig utun3 | rg 'inet ') ]] && tun=$(ifconfig utun3 | rg 'inet ' | awk '{print "["$2"] "}')

      lan=""
      [[ -n $(ifconfig en0 | rg 'inet ') ]] && lan=$(ifconfig en0 | rg 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}')
      [[ -n $(ifconfig en1 | rg 'inet ') ]] && lan=$(ifconfig en1 | rg 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}')
      [[ -n $(ifconfig en7 | rg 'inet ') ]] && lan=$(ifconfig en7 | rg 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}')
      [[ -n $(ifconfig en8 | rg 'inet ') ]] && lan=$(ifconfig en8 | rg 'inet ' | awk '$2 ~ /^[[:blank:]]*192/ {print $2}')

      [[ -n $wan ]] && wan="#[fg=brightblue]礪$wan"
      [[ -n $tun ]] && tun="#[fg=colour136]\uf982$tun"
      [[ -n $lan ]] && lan="#[fg=white] #[fg=yellow]$lan"

      echo "$wan$tun $lan"
      sleep 30
    else
      echo "#[fg=colour246]<redacted>"
    fi
  done
