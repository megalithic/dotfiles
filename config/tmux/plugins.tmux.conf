# -------------------------------------------------------------------------------------------------
# NOTE:
# prefix+I            -> install
# prefix+U            -> update
# prefix+alt+u (M-u)  -> uninstall
# -------------------------------------------------------------------------------------------------

set-environment -g "TMUX_PLUGIN_MANAGER_PATH" "~/.local/share/tmux/plugins"

# # install tpm if not already installed
# if "test ! -d ~/.local/share/tmux/plugins/tpm" \
#    "run 'git clone https://github.com/tmux-plugins/tpm ~/.local/share/tmux/plugins/tpm'"
# run "~/.local/share/tmux/plugins/tpm/tpm"

set -g @plugin "tmux-plugins/tpm"

# use kagi for searching selected term (<prefix>shift-s)
set -g @open-S 'https://www.kagi.com/search?q='

if-shell "command -v xdg-open 2>/dev/null" { set -g @plugin 'tmux-plugins/tmux-open' }
set -g @plugin "NHDaly/tmux-better-mouse-mode"
set -g @plugin "soyuka/tmux-current-pane-hostname"
set -g @plugin "roosta/tmux-pop" # flashes the pane you're switching to
set -g @plugin "tmux-plugins/tmux-cowboy" # prefix + * (kill process in current pane with extreme prejudice)

# show if connected to internet
set -g @online_icon " ï‚¬ "
set -g @offline_icon " ï™š "
# for online status
set -g @online_icon "#[fg=#9dd78e,bold] online"
set -g @offline_icon "#[fg=#e5706b,bold] offline!"
set -g @plugin 'tmux-plugins/tmux-online-status'

## -- tmux-mode-indicator
set -g @plugin 'MunifTanjim/tmux-mode-indicator'
session_icon="#(tmux-var 'SESSION_ICON')"
session_fg="#(tmux-var 'SESSION_FG')"
session_bg="#(tmux-var 'SESSION_BG')"

# prompt to display when tmux prefix key is pressed
set -g @mode_indicator_prefix_prompt " ï± WAIT " # alts: â€¦
# prompt to display when tmux is in copy mode
set -g @mode_indicator_copy_prompt " ï’» COPY "
# prompt to display when tmux has synchronized panes
set -g @mode_indicator_sync_prompt " ó°“¦ SYNC "
# prompt to display when tmux is in normal mode
set -g @mode_indicator_empty_prompt " ${session_icon} #S " # alts: ïœ·ï’(\uf490)ï¬¿
# style values for prefix prompt
set -g @mode_indicator_prefix_mode_style 'fg=#e67e80,bg=#323d43,italics'
# style values for copy prompt
set -g @mode_indicator_copy_mode_style 'fg=#3c474d,bg=#d9bb80,bold'
# style values for sync prompt
set -g @mode_indicator_sync_mode_style 'fg=black,bg=#e67e80,italics'
# style values for empty prompt
set -g @mode_indicator_empty_mode_style "fg=${session_fg},bg=${session_bg},bold"

## -- tmux-suspend
set -g @plugin 'MunifTanjim/tmux-suspend'
set -g @suspend_key 'F6'
set -g @suspend_suspended_options " \
  @mode_indicator_custom_prompt:: ó°¤ , \
  @mode_indicator_custom_mode_style::bg=#3c474d\\,fg=red, \
"

## -- tmux-copycat/yank
set -g @plugin "tmux-plugins/tmux-yank"
set -g @plugin "tmux-plugins/tmux-copycat"
# set -g @copycat_search C-/

## -- tmux cpu
set -g @plugin "tmux-plugins/tmux-cpu"
set -g @cpu_percentage_format "%3.0f%% "

## -- tmux-pomodoro-plus
set -g @pomodoro_notifications 'on'

set -g @pomodoro_toggle 'p'                    # Start/pause a Pomodoro/break
set -g @pomodoro_cancel 'P'                    # Cancel the current session
set -g @pomodoro_skip '-'                      # Skip a Pomodoro/break

set -g @pomodoro_mins 25                       # The duration of the Pomodoro
set -g @pomodoro_break_mins 5                  # The duration of the break after the Pomodoro completes
set -g @pomodoro_intervals 4                   # The number of intervals before a longer break is started
set -g @pomodoro_long_break_mins 25            # The duration of the long break
set -g @pomodoro_repeat 'off'                  # Automatically repeat the Pomodoros?

set -g @pomodoro_on "#[fg=red,italics] î€"       # alts: ğŸ…
set -g @pomodoro_complete "#[fg=green] ï˜"
set -g @pomodoro_pause "#[fg=yellow] ïŒ"         # The formatted output when the Pomodoro/break is paused
set -g @pomodoro_prompt_break " ïŒ break?"       # The formatted output when waiting to start a break
set -g @pomodoro_prompt_pomodoro " ï‹ start?"    # The formatted output when waiting to start a Pomodoro
set -g @pomodoro_show_intervals "#[fg=$color_gray] [%s/%s]"

set -g @pomodoro_menu_position "R"             # The location of the menu relative to the screen
set -g @pomodoro_sound 'Pop'                   # Sound for desktop notifications (Run `ls /System/Library/Sounds` for a list of sounds to use on Mac)
set -g @pomodoro_notifications 'on'            # Enable desktop notifications from your terminal
set -g @pomodoro_granularity 'off'

## -- tmux-fuzzback
set -g @plugin "roosta/tmux-fuzzback" # prefix + / (fzf search backwards)
set -g @fuzzback-bind 'f'
# set -g @fuzzback-bind '-n C-//'
set -g @fuzzback-popup 0
set -g @fuzzback-popup-size '80%'

## -- tmux-cpu
set -g @cpu_medium_fg_color "#[fg=orange]"
set -g @cpu_high_fg_color "#[fg=red]"

## -- tmux-jump
# set -g @plugin "schasse/tmux-jump" # prefix + s (like easyjump, or hop.nvim)
# set -g @jump-key "/"

## -- tmux-navigate
set -g @navigate-left  "-n C-h"
set -g @navigate-down  "-n C-j"
set -g @navigate-up    "-n C-k"
set -g @navigate-right "-n C-l"
# set -g @navigate-back  "-n C-\\"


set -g @ton-prioritize-window true
# open files/urls selected in copy mode
set -g @plugin 'trevarj/tmux-open-nvim'


# Fuzzy find panes (prefix-P)
set -g @plugin 'dkarter/tmux-ff'

# use fzf to copy text from tmux into current command (prefix+TAB)
set -g @plugin 'laktak/extrakto'


# open urls on the tmux screen, and allow selecting one via fzf
set -g @fzf-url-fzf-options '-p70% -m -0 --no-preview'
set -g @plugin 'joshmedeski/tmux-fzf-url'

# -- tmux-thumbs
set -g @plugin "fcsonline/tmux-thumbs" # prefix + f (copy things)
set -g @thumbs-key 'C-f'
set -g @thumbs-unique enabled
set -g @thumbs-position off_left
# set -g @thumbs-regexp-1 '[a-z]+@[a-z]+.[a-z]+' # Match emails
# set -g @thumbs-regexp-2 '[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:' # Match MAC addresses
# set -g @thumbs-regexp-3 '\-\-[a-zA-Z0-9_]+' # options

# support for tmux-open-nvim
# Overrides matching file paths with :[line]:[col] at the end
set -g @thumbs-regexp-1 '(([.\w\-~\$@]+)?(/[.\w\-@]+)+/?)(:\d*){,2}'
# adds files with no directory (e.g. Taskfile.dist.yml) as long as they have
# an extension (also picks up version numbers and domain names :shrug:)
set -g @thumbs-regexp-2 '(\/?[\w\-])+(\.\w+)+(:\d+){,2}'
# Launches helper script on shift+[key] in fingers mode
# set -g @fingers-shift-action "xargs -I {} tmux run-shell 'cd #{pane_current_path}; ton {} 2>&1 /tmp/ton.log'"
set -g @fingers-shift-action "xargs -I{} tmux run-shell 'cd #{pane_current_path}; ton {} >> /tmp/ton.log'"
# /support for tmux-open-nvim

# set -g @thumbs-contrast 1
# set -g @thumbs-hint-fg-color red
set -g @thumbs-fg-color '#fab387'
set -g @thumbs-hint-fg-color '#a6e3a1'
set -g @thumbs-command 'echo -n {} | xargs open'
# set -g @thumbs-upcase-command 'echo -n {} | pbcopy && tmux display-message \"Copied {}\"'
set -g @thumbs-upcase-command "xargs -I{} tmux run-shell 'cd #{pane_current_path}; ton {} >> /tmp/ton.log'"
# set -g @thumbs-command 'tmux set-buffer -w "{}"'
# set -g @thumbs-upcase-command 'tmux set-buffer -w "{}" && tmux paste-buffer'

## -- tmux-battery
set -g @plugin "tmux-plugins/tmux-battery"
# REF: https://github.com/tmux-plugins/tmux-battery#iconscolors
set -g @batt_icon_charge_tier8 "ï‰€"
set -g @batt_icon_charge_tier7 "ï‰€"
set -g @batt_icon_charge_tier6 "ï‰"
set -g @batt_icon_charge_tier5 "ï‰"
set -g @batt_icon_charge_tier4 "ï‰‚"
set -g @batt_icon_charge_tier3 "ï‰‚"
set -g @batt_icon_charge_tier2 "ï‰ƒ"
set -g @batt_icon_charge_tier1 "ï‰ƒ"
set -g @batt_icon_status_charged "ó±ˆ‘"
set -g @batt_icon_status_charging "ó°‚„"
set -g @batt_icon_status_discharging "ó°‚Œ"
set -g @batt_icon_status_attached "ï‡¦" # alts: ï‡¦ï®£
set -g @batt_icon_status_unknown "ó°‚‘" # alts: ó±‹ó°‚‘ïƒ§îŒ•ó±‹
# set -g @batt_color_status_primary_discharging "#e39b7b"
set -g @batt_color_status_primary_charged "#a7c080"
set -g @batt_color_status_primary_charging "#d9bb80"
set -g @batt_color_status_primary_unknown "#795430"
# set -g @batt_color_charge_primary_discharging "#e39b7b"
set -g @batt_color_charge_primary_charged "#a7c080"
set -g @batt_color_charge_primary_charging "#d9bb80"
set -g @batt_color_charge_primary_unknown "#795430"
# set -g @batt_color_primary_discharging "#e39b7b"
set -g @batt_color_primary_charged "#a7c080"
set -g @batt_color_primary_charging "#d9bb80"
set -g @batt_color_primary_unknown "#795430"
set -g @batt_remain_short true

## -- tmux-popup / fzf options
TMUX_FZF_OPTIONS="-p -w 50% -h 50% -m"
# TMUX_FZF_LAUNCH_KEY="C-t"

## -- tmux-menus
# unbind the default tmux menus:
unbind-key -n MouseDown3Pane
unbind-key -n M-MouseDown3Pane
unbind-key -n MouseDown3Status
unbind-key -n MouseDown3StatusLeft
unbind-key <
unbind-key >
set -g @menus_trigger "C-m"

## -- extrakto
set -g @extrakto_key "tab"
set -g @extrakto_popup_size "50%"

# -- tmux-window-names
# set -g @tmux_window_name_ignored_programs "['sqlite3', 'weechat']"
# set -g @tmux_window_name_dir_programs "['nvim', 'git', 'fugitive', 'git_tree']"

# -- tmux-text-macros
set -g @ttm-load-default-macros on # no default macros
set -g @ttm-window-mode 'vertical'

# if "test ! -d ~/.local/share/tmux/plugins/tpm" \
#    "run 'git clone https://github.com/tmux-plugins/tpm ~/.local/share/tmux/plugins/tpm'"
# run-shell "~/.local/share/tmux/plugins/tpm/tpm"
#

# install tpm if not already installed
if "test ! -d ~/.local/share/tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.local/share/tmux/plugins/tpm'"
run "~/.local/share/tmux/plugins/tpm/tpm"
